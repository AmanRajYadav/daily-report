<!DOCTYPE html>
<html lang="en" data-theme="minimal">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{{STUDENT_NAME}} ¬∑ Learning Universe</title>
    <meta name="description" content="A magical learning journey">
    
    <!-- Preload critical assets -->
    <link rel="preload" href="../assets/sounds/effects/sparkle.mp3" as="audio">
    <link rel="preload" href="../assets/sprites/creatures/math-dragon.svg" as="image">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/themes/minimal.css" id="theme-stylesheet">
    
    <style>
        /* Dynamic student color */
        :root {
            --student-hue: {{STUDENT_HUE}};
            --student-accent: hsl(var(--student-hue), 70%, 60%);
            --student-accent-soft: hsl(var(--student-hue), 60%, 95%);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="magic-circle">
                <svg viewBox="0 0 200 200">
                    <circle cx="100" cy="100" r="80" class="circle-outer" />
                    <circle cx="100" cy="100" r="60" class="circle-middle" />
                    <circle cx="100" cy="100" r="40" class="circle-inner" />
                </svg>
            </div>
            <p class="loading-text">Preparing your magical journey...</p>
        </div>
    </div>


    <!-- Living Background -->
    <div class="universe-container">
        <!-- WebGL Canvas for advanced effects -->
        <canvas id="magicCanvas"></canvas>
        
        <!-- Parallax Layers -->
        <div class="parallax-layer" data-depth="0.1">
            <div class="clouds"></div>
        </div>
        <div class="parallax-layer" data-depth="0.3">
            <div class="floating-elements"></div>
        </div>
        <div class="parallax-layer" data-depth="0.5">
            <div class="fireflies"></div>
        </div>
        
        <!-- Seasonal Overlay -->
        <div class="seasonal-overlay" id="seasonalOverlay"></div>
    </div>

    <!-- Background Toggle Button -->
    <button class="background-toggle" id="backgroundToggle" title="Toggle background theme">
        üåô
    </button>

    <!-- Learning Tree (Fixed Position) -->
    <div class="learning-tree-container">
        <div class="tree-stage" id="learningTree">
            <!-- Tree will be drawn here by tree.js -->
        </div>
        <div class="tree-info">
            <span class="visits-count">Visit #<span id="visitNumber">1</span></span>
            <span class="tree-stage-name" id="treeStageName">Seedling</span>
        </div>
    </div>

    <!-- Top GIF Animals Container -->
    <div class="top-animals-container" id="topAnimalsContainer">
        <!-- GIF animals will be added by creatures.js -->
    </div>

    <!-- Walking Animals Container -->
    <div class="animals-container" id="animalsContainer">
        <!-- Animated sprites will be added by creatures.js -->
    </div>


    <!-- Main Content -->
    <main class="content-wrapper">
        <!-- Hero Section -->
        <section class="hero-section" id="heroSection">
            <div class="hero-particles" id="heroParticles"></div>
            
            <div class="date-badge floating">{{DATE}}</div>
            
            <h1 class="student-name magical-text">
                {{STUDENT_NAME}}
                <span class="name-sparkles"></span>
            </h1>
            
            <p class="hero-greeting">Welcome back to your learning universe</p>
            
            <!-- Student Avatar with Aura -->
            <div class="student-avatar-container">
                <div class="avatar-aura"></div>
                <div class="student-avatar" id="studentAvatar">
                    <div class="avatar-inner"></div>
                </div>
            </div>
        </section>

        <!-- Today's Reflection -->
        <section class="content-card floating-card" data-sound="page-turn" data-creature="star">
            <div class="card-background-effect"></div>
            
            <header class="card-header">
                <div class="section-icon animated-icon">
                    <svg viewBox="0 0 48 48">
                        <path class="icon-path" d="M24 4l5.5 11.1L42 17l-9 8.8L35.1 38 24 32.2 12.9 38 15 25.8 6 17l12.5-1.9z"/>
                    </svg>
                </div>
                <h2 class="section-title">Today's Reflection</h2>
            </header>
            
            <div class="card-content touchable" data-read-aloud="true">
                <p class="reflection-text">
                    {{GREETING_SECTION}}
                </p>
            </div>
            
            <div class="tap-hint">Tap to hear ‚Ä¢ Long press for Hindi</div>
        </section>

        <!-- Learning Content -->
        <section class="content-card floating-card" data-sound="page-turn" data-creature="{{SUBJECT_CREATURE}}">
            <div class="card-background-effect"></div>
            
            <!-- Subject Creature -->
            <div class="subject-creature-container">
                <div class="creature-home" id="creatureHome">
                    <!-- Animated creature will be loaded here -->
                </div>
            </div>
            
            <header class="card-header">
                <div class="section-icon animated-icon">
                    <svg viewBox="0 0 48 48">
                        <path class="icon-path" d="M4 6h8c2.2 0 4 1.8 4 4v28c0-1.7-1.3-3-3-3H4V6zm40 0h-8c-2.2 0-4 1.8-4 4v28c0-1.7 1.3-3 3-3h9V6z"/>
                    </svg>
                </div>
                <h2 class="section-title">What We Explored</h2>
            </header>
            
            <div class="subject-badge magical-badge">{{SUBJECT_TITLE}}</div>
            
            <div class="card-content touchable" data-read-aloud="true">
                <p class="learning-content">
                    {{DETAILED_CONTENT}}
                </p>
            </div>
        </section>

        {{#IF_ACTIVITY}}
        <!-- Activity Section -->
        <section class="content-card floating-card activity-card" data-sound="chime" data-creature="rocket">
            <div class="card-background-effect"></div>
            
            <header class="card-header">
                <div class="section-icon animated-icon">
                    <svg viewBox="0 0 48 48">
                        <circle cx="24" cy="24" r="20" class="clock-circle"/>
                        <path class="clock-hand" d="M24 12v12l8 4"/>
                    </svg>
                </div>
                <h2 class="section-title">Your Mission</h2>
            </header>
            
            <div class="mission-name">{{ACTIVITY_NAME}}</div>
            
            <div class="card-content touchable" data-read-aloud="true">
                <div class="mission-description">
                    <p>{{TASK_DESCRIPTION}}</p>
                </div>
                
                <div class="mission-motivation">
                    <span class="sparkle-text">‚ú® Why it's amazing:</span>
                    <p>{{WHY_ITS_COOL}}</p>
                </div>
            </div>
            
            <!-- Hidden treasure that appears on shake -->
            <div class="hidden-treasure" id="hiddenTreasure">
                <span class="treasure-emoji">üéÅ</span>
                <p class="treasure-message">Secret discovered! You're amazing!</p>
            </div>
        </section>
        {{/IF_ACTIVITY}}

        {{#IF_PARENT_REPORT}}
        <!-- Parent Update -->
        <section class="content-card floating-card parent-card" data-sound="notification">
            <div class="card-background-effect"></div>
            
            <header class="card-header">
                <div class="section-icon animated-icon">
                    <svg viewBox="0 0 48 48">
                        <path d="M31 28v-4c0-3.3-2.7-6-6-6h-10c-3.3 0-6 2.7-6 6v4"/>
                        <circle cx="20" cy="10" r="6"/>
                        <path d="M39 28v-4c0-2.8-1.9-5.1-4.5-5.8"/>
                        <path d="M33 4.2c2.6.7 4.5 3 4.5 5.8s-1.9 5.1-4.5 5.8"/>
                    </svg>
                </div>
                <h2 class="section-title">Family Update</h2>
            </header>
            
            <div class="parent-report-grid">
                <div class="report-item">
                    <h3 class="report-label">Today's Focus</h3>
                    <p>{{CLASS_FOCUS}}</p>
                </div>
                
                <div class="report-item">
                    <h3 class="report-label">Progress Made</h3>
                    <p>{{CONTENT_COVERED}}</p>
                </div>
                
                {{#IF_HOMEWORK}}
                <div class="report-item">
                    <h3 class="report-label">Home Practice</h3>
                    <p>{{HOMEWORK_ASSIGNMENT}}</p>
                </div>
                {{/IF_HOMEWORK}}
                
                {{#IF_NOTES}}
                <div class="report-item">
                    <h3 class="report-label">Special Notes</h3>
                    <p>{{ADDITIONAL_NOTES}}</p>
                </div>
                {{/IF_NOTES}}
            </div>
        </section>
        {{/IF_PARENT_REPORT}}

        <!-- Arcade Portal -->
        <section class="arcade-portal-section">
            <div class="portal-container">
                <div class="portal-rings">
                    <div class="ring ring-1"></div>
                    <div class="ring ring-2"></div>
                    <div class="ring ring-3"></div>
                </div>
                
                <a href="https://amanrajyadav.github.io/fluence-quiz/" class="arcade-button magical-button">
                    <span class="button-bg"></span>
                    <span class="button-text">Enter Learning Arcade</span>
                    <span class="button-icon">üéÆ</span>
                </a>
            </div>
        </section>
    </main>

    <!-- Shake Message Overlay -->
    <div class="shake-overlay" id="shakeOverlay">
        <div class="stardust-container" id="stardustContainer"></div>
        <div class="shake-message">
            <h3>‚ú® Magic Unlocked! ‚ú®</h3>
            <p>You found a hidden surprise!</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/universe.js"></script>
    <script src="../assets/js/creatures.js"></script>
    <script src="../assets/js/audio.js"></script>
    <script src="../assets/js/particles.js"></script>
    <script src="../assets/js/tree.js"></script>
    <script src="../assets/js/features.js"></script>
    <script src="../assets/js/magic.js"></script>
    
    <script>
        // Initialize with student data
        window.STUDENT_DATA = {
            name: '{{STUDENT_NAME}}',
            id: '{{STUDENT_ID}}',
            hue: {{STUDENT_HUE}},
            subject: '{{SUBJECT_TITLE}}',
            visitCount: parseInt(localStorage.getItem('visits_{{STUDENT_ID}}') || '0') + 1
        };
        
        // Background toggle functionality
        function initBackgroundToggle() {
            const toggleBtn = document.getElementById('backgroundToggle');
            const body = document.body;
            
            // Check for saved preference
            const savedTheme = localStorage.getItem('backgroundTheme');
            if (savedTheme === 'light') {
                body.classList.add('light-mode');
                toggleBtn.classList.add('light-mode');
                toggleBtn.textContent = '‚òÄÔ∏è';
            }
            
            toggleBtn.addEventListener('click', () => {
                body.classList.toggle('light-mode');
                toggleBtn.classList.toggle('light-mode');
                
                if (body.classList.contains('light-mode')) {
                    toggleBtn.textContent = '‚òÄÔ∏è';
                    localStorage.setItem('backgroundTheme', 'light');
                } else {
                    toggleBtn.textContent = 'üåô';
                    localStorage.setItem('backgroundTheme', 'dark');
                }
            });
        }
        
        // Start the magic
        document.addEventListener('DOMContentLoaded', () => {
            Universe.init();
            initBackgroundToggle();
        });
    </script>
</body>
</html>
